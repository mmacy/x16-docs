
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Adventures in turn-based text">
      
      
        <meta name="author" content="Marsh Macy">
      
      
        <link rel="canonical" href="https://mmacy.github.io/x16-docs/X16%20Reference%20-%2009%20-%20VERA%20Programmer%27s%20Reference/">
      
      
        <link rel="prev" href="../X16%20Reference%20-%2008%20-%20Memory%20Map/">
      
      
        <link rel="next" href="../X16%20Reference%20-%2010%20-%20VERA%20FX%20Reference/">
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.0, mkdocs-material-9.5.24">
    
    
      
        <title>9: VERA Programmer's Reference - Commander X16 Documentation (UNOFFICIAL)</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.6543a935.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Actor:300,300i,400,400i,700,700i%7CChivo+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Actor";--md-code-font:"Chivo Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="blue-grey" data-md-color-accent="orange">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#9-vera-programmers-reference" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Commander X16 Documentation (UNOFFICIAL)" class="md-header__button md-logo" aria-label="Commander X16 Documentation (UNOFFICIAL)" data-md-component="logo">
      
  <img src="../images/logo_text.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Commander X16 Documentation (UNOFFICIAL)
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              9: VERA Programmer's Reference
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="blue-grey" data-md-color-accent="orange"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="blue-grey" data-md-color-accent="orange"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12c0-2.42-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
          <a href="javascript:void(0)" class="md-search__icon md-icon" title="Share" aria-label="Share" data-clipboard data-clipboard-text="" data-md-component="search-share" tabindex="-1">
            
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7 0-.24-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91 1.61 0 2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08Z"/></svg>
          </a>
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/mmacy/x16-docs" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    x16-docs
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Commander X16 Documentation (UNOFFICIAL)" class="md-nav__button md-logo" aria-label="Commander X16 Documentation (UNOFFICIAL)" data-md-component="logo">
      
  <img src="../images/logo_text.png" alt="logo">

    </a>
    Commander X16 Documentation (UNOFFICIAL)
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/mmacy/x16-docs" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    x16-docs
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../X16%20Reference%20-%2001%20-%20Overview/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    1: Overview
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../X16%20Reference%20-%2002%20-%20Getting%20Started/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2: Getting Started
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../X16%20Reference%20-%2003%20-%20Editor/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    3: Editor
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../X16%20Reference%20-%2004%20-%20BASIC/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    4: BASIC Programming
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../X16%20Reference%20-%2005%20-%20KERNAL/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    5: KERNAL
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../X16%20Reference%20-%2006%20-%20Math%20Library/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    6: Math Library
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../X16%20Reference%20-%2007%20-%20Machine%20Language%20Monitor/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    7: Machine Language Monitor
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../X16%20Reference%20-%2008%20-%20Memory%20Map/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    8: Memory Map
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    9: VERA Programmer's Reference
  </span>
  

      </a>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../X16%20Reference%20-%2010%20-%20VERA%20FX%20Reference/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    10: VERA FX Reference
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../X16%20Reference%20-%2011%20-%20Sound%20Programming/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    11: Sound Programming
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../X16%20Reference%20-%2012%20-%20IO%20Programming/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    12: I/O Programming
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../X16%20Reference%20-%2013%20-%20Working%20with%20CMDR-DOS/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    13: Working With CMDR-DOS
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../X16%20Reference%20-%2014%20-%20Hardware/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    14: Hardware Pinouts
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../X16%20Reference%20-%2015%20-%20Upgrade%20Guide/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    15: Upgrade Guide
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../X16%20Reference%20-%20Appendix%20A%20-%20Sound/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Appendix A: Sound
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../X16%20Reference%20-%20Appendix%20B%20-%20VERA%20Recovery/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Appendix B: VERA Firmware Recovery
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../X16%20Reference%20-%20Appendix%20C%20-%2065C02%20Processor/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Appendix C: The 65C02 Processor
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../X16%20Reference%20-%20Appendix%20D%20-%20Official%20Expansion%20Cards/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Appendix D: Official Expansion Cards
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../X16%20Reference%20-%20Appendix%20E%20-%20Diagnostic%20Bank/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Appendix E: Diagnostic Bank
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../X16%20Reference%20-%20Appendix%20F%20-%2065C816%20Processor/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Appendix F: The 65C816 Processor
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


<h1 id="9-vera-programmers-reference">9: VERA Programmer's Reference</h1>
<p>This document describes the <strong>V</strong>ersatile <strong>E</strong>mbedded <strong>R</strong>etro <strong>A</strong>dapter or VERA.
Which was originally written and conceived by Frank van den Hoef.</p>
<p>The VERA video chip supports resolutions up to 640x480 with up to 256 colors
from a palette of 4096, two layers of either a bitmap or tiles, 128 sprites of
up to 64x64 pixels in size. It can output VGA as well as a 525 line interlaced
signal, either as NTSC or as RGB (Amiga-style).</p>
<p>The FPGA core used in the Commander X16 has been forked from Version 0.9 of the
VERA. The original documentation can be found
<a href="https://github.com/fvdhoef/vera-module/blob/rev4/doc/VERA%20Programmer's%20Reference.md#vera-programmers-reference">here</a>.</p>
<p>The Commander X16 uses a modified version of VERA which includes extra
functionality, notably the FX Aid additions. See
<a href="../X16%20Reference%20-%2010%20-%20VERA%20FX%20Reference/#chapter-10-vera-fx-reference">Chapter 10</a>
for more information on the FX additions.</p>
<p>The VERA consists of:</p>
<ul>
<li>Video generator featuring:</li>
<li>Multiple output formats (VGA, NTSC Composite, NTSC S-Video, RGB video) at a fixed resolution of 640x480@60Hz</li>
<li>Support for 2 layers, both supporting either tile or bitmap mode.</li>
<li>Support for up to 128 sprites.</li>
<li>Embedded video RAM of 128kB.</li>
<li>Palette with 256 colors selected from a total range of 4096 colors.</li>
<li>16-channel Programmable Sound Generator with multiple waveforms (Pulse, Sawtooth, Triangle, Noise)</li>
<li>High quality PCM audio playback from an 4kB FIFO buffer featuring up to 48kHz 16-bit stereo sound.</li>
<li>SPI controller for SecureDigital storage.</li>
</ul>
<h1 id="registers">Registers</h1>
<table>
    <tr>
        <th>Addr</th>
        <th>Name</th>
        <th>Bit&nbsp;7</th>
        <th>Bit&nbsp;6</th>
        <th>Bit&nbsp;5 </th>
        <th>Bit&nbsp;4</th>
        <th>Bit&nbsp;3 </th>
        <th>Bit&nbsp;2</th>
        <th>Bit&nbsp;1 </th>
        <th>Bit&nbsp;0</th>
    </tr>
    <tr>
        <td>$9F20</td>
        <td>ADDRx_L (x=ADDRSEL)</td>
        <td colspan="8" align="center">VRAM Address (7:0)</td>
    </tr>
    <tr>
        <td>$9F21</td>
        <td>ADDRx_M (x=ADDRSEL)</td>
        <td colspan="8" align="center">VRAM Address (15:8)</td>
    </tr>
    <tr>
        <td>$9F22</td>
        <td>ADDRx_H (x=ADDRSEL)</td>
        <td colspan="4" align="center">Address Increment</td>
        <td align="center">DECR</td>
        <td align="center">Nibble Increment</td>
        <td align="center">Nibble Address</td>
        <td align="center">VRAM Address (16)</td>
    </tr>
    <tr>
        <td>$9F23</td>
        <td>DATA0</td>
        <td colspan="8" align="center">VRAM Data port 0</td>
    </tr>
    <tr>
        <td>$9F24</td>
        <td>DATA1</td>
        <td colspan="8" align="center">VRAM Data port 1</td>
    </tr>
    <tr>
        <td>$9F25</td>
        <td>CTRL</td>
        <td colspan="1" align="center">Reset</td>
        <td colspan="6" align="center">DCSEL</td>
        <td colspan="1" align="center">ADDRSEL</td>
    </tr>
    <tr>
        <td>$9F26</td>
        <td>IEN</td>
        <td colspan="1" align="center">IRQ line (8)</td>
        <td colspan="1" align="center">Scan line (8)</td>
        <td colspan="2" align="center">-</td>
        <td colspan="1" align="center">AFLOW</td>
        <td colspan="1" align="center">SPRCOL</td>
        <td colspan="1" align="center">LINE</td>
        <td colspan="1" align="center">VSYNC</td>
    </tr>
    <tr>
        <td>$9F27</td>
        <td>ISR</td>
        <td colspan="4" align="center">Sprite collisions</td>
        <td colspan="1" align="center">AFLOW</td>
        <td colspan="1" align="center">SPRCOL</td>
        <td colspan="1" align="center">LINE</td>
        <td colspan="1" align="center">VSYNC</td>
    </tr>
    <tr>
        <td>$9F28</td>
        <td>IRQLINE_L (Write only)</td>
        <td colspan="8" align="center">IRQ line (7:0)</td>
    </tr>
    <tr>
        <td>$9F28</td>
        <td>SCANLINE_L (Read only)</td>
        <td colspan="8" align="center">Scan line (7:0)</td>
    </tr>
    <tr>
        <td>$9F29</td>
        <td>DC_VIDEO (DCSEL=0)</td>
        <td colspan="1" align="center">Current Field</td>
        <td colspan="1" align="center">Sprites Enable</td>
        <td colspan="1" align="center">Layer1 Enable</td>
        <td colspan="1" align="center">Layer0 Enable</td>
        <td colspan="1" align="center">NTSC/RGB: 240P</td>
        <td colspan="1" align="center">NTSC: Chroma Disable / RGB: HV Sync </td>
        <td colspan="2" align="center">Output Mode</td>
    </tr>
    <tr>
        <td>$9F2A</td>
        <td>DC_HSCALE<br>(DCSEL=0)</td>
        <td colspan="8" align="center">Active Display H-Scale</td>
    </tr>
    <tr>
        <td>$9F2B</td>
        <td>DC_VSCALE<br>(DCSEL=0)</td>
        <td colspan="8" align="center">Active Display V-Scale</td>
    </tr>
    <tr>
        <td>$9F2C</td>
        <td>DC_BORDER<br>(DCSEL=0)</td>
        <td colspan="8" align="center">Border Color</td>
    </tr>
    <tr>
        <td>$9F29</td>
        <td>DC_HSTART<br>(DCSEL=1)</td>
        <td colspan="8" align="center">Active Display H-Start (9:2)</td>
    </tr>
    <tr>
        <td>$9F2A</td>
        <td>DC_HSTOP<br>(DCSEL=1)</td>
        <td colspan="8" align="center">Active Display H-Stop (9:2)</td>
    </tr>
    <tr>
        <td>$9F2B</td>
        <td>DC_VSTART<br>(DCSEL=1)</td>
        <td colspan="8" align="center">Active Display V-Start (8:1)</td>
    </tr>
    <tr>
        <td>$9F2C</td>
        <td>DC_VSTOP<br>(DCSEL=1)</td>
        <td colspan="8" align="center">Active Display V-Stop (8:1)</td>
    </tr>
    <tr>
        <td>$9F29</td>
        <td>FX_CTRL<br>(DCSEL=2)</td>
        <td align="center">Transp. Writes</td>
        <td align="center">Cache Write Enable</td>
        <td align="center">Cache Fill Enable</td>
        <td align="center">One-byte Cache Cycling</td>
        <td align="center">16-bit Hop</td>
        <td align="center">4-bit Mode</td>
        <td colspan="2" align="center">Addr1 Mode</td>
    </tr>
    <tr>
        <td>$9F2A</td>
        <td>FX_TILEBASE<br>(DCSEL=2)<br>(Write only)</td>
        <td colspan="6" align="center">FX Tile Base Address (16:11)</td>
        <td align="center">Affine Clip Enable</td>
        <td align="center">2-bit Polygon</td>
    </tr>
    <tr>
        <td>$9F2B</td>
        <td>FX_MAPBASE<br>(DCSEL=2)<br>(Write only)</td>
        <td colspan="6" align="center">FX Map Base Address (16:11)</td>
        <td colspan="2" align="center">Map Size</td>
    </tr>
    <tr>
        <td>$9F2C</td>
        <td>FX_MULT<br>(DCSEL=2)<br>(Write only)</td>
        <td align="center">Reset Accum.</td>
        <td align="center">Accumulate</td>
        <td align="center">Subtract Enable</td>
        <td align="center">Multiplier Enable</td>
        <td colspan="2" align="center">Cache Byte Index</td>
        <td align="center">Cache Nibble Index</td>
        <td align="center">Two-byte Cache Incr. Mode</td>
    </tr>
    <tr>
        <td>$9F29</td>
        <td>FX_X_INCR_L<br>(DCSEL=3)<br>(Write only)</td>
        <td colspan="8" align="center">X Increment (-2:-9) (signed)</td>
    </tr>
    <tr>
        <td>$9F2A</td>
        <td>FX_X_INCR_H<br>(DCSEL=3)<br>(Write only)</td>
        <td align="center">X Incr. 32x</td>
        <td colspan="7" align="center">X Increment (5:-1) (signed)</td>
    </tr>
    <tr>
        <td>$9F2B</td>
        <td>FX_Y_INCR_L<br>(DCSEL=3)<br>(Write only)</td>
        <td colspan="8" align="center">Y/X2 Increment (-2:-9) (signed)</td>
    </tr>
    <tr>
        <td>$9F2C</td>
        <td>FX_Y_INCR_H<br>(DCSEL=3)<br>(Write only)</td>
        <td align="center">Y/X2 Incr. 32x</td>
        <td colspan="7" align="center">Y/X2 Increment (5:-1) (signed)</td>
    </tr>
    <tr>
        <td>$9F29</td>
        <td>FX_X_POS_L<br>(DCSEL=4)<br>(Write only)</td>
        <td colspan="8" align="center">X Position (7:0)</td>
    </tr>
    <tr>
        <td>$9F2A</td>
        <td>FX_X_POS_H<br>(DCSEL=4)<br>(Write only)</td>
        <td align="center">X Pos. (-9)</td>
        <td colspan="4" align="center">-</td>
        <td colspan="3" align="center">X Position (10:8)</td>
    </tr>
    <tr>
        <td>$9F2B</td>
        <td>FX_Y_POS_L<br>(DCSEL=4)<br>(Write only)</td>
        <td colspan="8" align="center">Y/X2 Position (7:0)</td>
    </tr>
    <tr>
        <td>$9F2C</td>
        <td>FX_Y_POS_H<br>(DCSEL=4)<br>(Write only)</td>
        <td align="center">Y/X2 Pos. (-9)</td>
        <td colspan="4" align="center">-</td>
        <td colspan="3" align="center">Y/X2 Position (10:8)</td>
    </tr>
    <tr>
        <td>$9F29</td>
        <td>FX_X_POS_S<br>(DCSEL=5)<br>(Write only)</td>
        <td colspan="8" align="center">X Postion (-1:-8)</td>
    </tr>
    <tr>
        <td>$9F2A</td>
        <td>FX_Y_POS_S<br>(DCSEL=5)<br>(Write only)</td>
        <td colspan="8" align="center">Y/X2 Postion (-1:-8)</td>
    </tr>
    <tr>
        <td>$9F2B</td>
        <td>FX_POLY_FILL_L<br>(DCSEL=5, 4-bit Mode=0)<br>(Read only)</td>
        <td align="center">Fill Len >= 16</td>
        <td colspan="2" align="center">X Position (1:0)</td>
        <td colspan="4" align="center">Fill Len (3:0)</td>
        <td align="center">0</td>
    </tr>
    <tr>
        <td>$9F2B</td>
        <td>FX_POLY_FILL_L<br>(DCSEL=5, 4-bit Mode=1, 2-bit Polygon=0)<br>(Read only)</td>
        <td align="center">Fill Len >= 8</td>
        <td colspan="2" align="center">X Position (1:0)</td>
        <td align="center">X Pos. (2)</td>
        <td colspan="3" align="center">Fill Len (2:0)</td>
        <td align="center">0</td>
    </tr>
    <tr>
        <td>$9F2B</td>
        <td>FX_POLY_FILL_L<br>(DCSEL=5, 4-bit Mode=1, 2-bit Polygon=1)<br>(Read only)</td>
        <td align="center">X2 Pos. (-1)</td>
        <td colspan="2" align="center">X Position (1:0)</td>
        <td align="center">X Pos. (2)</td>
        <td colspan="3" align="center">Fill Len (2:0)</td>
        <td align="center">X Pos. (-1)</td>
    </tr>
    <tr>
        <td>$9F2C</td>
        <td>FX_POLY_FILL_H<br>(DCSEL=5)<br>(Read only)</td>
        <td colspan="7" align="center">Fill Len (9:3)</td>
        <td align="center">0</td>
    </tr>
    <tr>
        <td>$9F29</td>
        <td>FX_CACHE_L<br>(DCSEL=6)<br>(Write only)</td>
        <td colspan="8" align="center">Cache (7:0) | Multiplicand (7:0) (signed)</td>
    </tr>
    <tr>
        <td>$9F29</td>
        <td>FX_ACCUM_RESET<br>(DCSEL=6)<br>(Read only)</td>
        <td colspan="8" align="center">Reset Accumulator</td>
    </tr>
    <tr>
        <td>$9F2A</td>
        <td>FX_CACHE_M<br>(DCSEL=6)<br>(Write only)</td>
        <td colspan="8" align="center">Cache (15:8) | Multiplicand (15:8) (signed)</td>
    </tr>
    <tr>
        <td>$9F2A</td>
        <td>FX_ACCUM<br>(DCSEL=6)<br>(Read only)</td>
        <td colspan="8" align="center">Accumulate</td>
    </tr>
    <tr>
        <td>$9F2B</td>
        <td>FX_CACHE_H<br>(DCSEL=6)<br>(Write only)</td>
        <td colspan="8" align="center">Cache (23:16) | Multiplier (7:0) (signed)</td>
    </tr>
    <tr>
        <td>$9F2C</td>
        <td>FX_CACHE_U<br>(DCSEL=6)<br>(Write only)</td>
        <td colspan="8" align="center">Cache (31:24) | Multiplier (15:8) (signed)</td>
    </tr>
    <tr>
        <td>$9F29</td>
        <td>DC_VER0<br>(DCSEL=63)<br>(Read only)</td>
        <td colspan="8" align="center">The ASCII character "V"</td>
    </tr>
    <tr>
        <td>$9F2A</td>
        <td>DC_VER1<br>(DCSEL=63)<br>(Read only)</td>
        <td colspan="8" align="center">Major release</td>
    </tr>
    <tr>
        <td>$9F2B</td>
        <td>DC_VER2<br>(DCSEL=63)<br>(Read only)</td>
        <td colspan="8" align="center">Minor release</td>
    </tr>
    <tr>
        <td>$9F2C</td>
        <td>DC_VER3<br>(DCSEL=63)<br>(Read only)</td>
        <td colspan="8" align="center">Minor build number</td>
    </tr>
    <tr>
        <td>$9F2D</td>
        <td>L0_CONFIG</td>
        <td colspan="2" align="center">Map Height</td>
        <td colspan="2" align="center">Map Width</td>
        <td colspan="1" align="center">T256C</td>
        <td colspan="1" align="center">Bitmap Mode</td>
        <td colspan="2" align="center">Color Depth</td>
    </tr>
    <tr>
        <td>$9F2E</td>
        <td>L0_MAPBASE</td>
        <td colspan="8" align="center">Map Base Address (16:9)</td>
    </tr>
    <tr>
        <td>$9F2F</td>
        <td>L0_TILEBASE</td>
        <td colspan="6" align="center">Tile Base Address (16:11)</td>
        <td colspan="1" align="center">Tile Height</td>
        <td colspan="1" align="center">Tile Width</td>
    </tr>
    <tr>
        <td>$9F30</td>
        <td>L0_HSCROLL_L</td>
        <td colspan="8" align="center">H-Scroll (7:0)</td>
    </tr>
    <tr>
        <td>$9F31</td>
        <td>L0_HSCROLL_H</td>
        <td colspan="4" align="center">-</td>
        <td colspan="8" align="center">H-Scroll (11:8)</td>
    </tr>
    <tr>
        <td>$9F32</td>
        <td>L0_VSCROLL_L</td>
        <td colspan="8" align="center">V-Scroll (7:0)</td>
    </tr>
    <tr>
        <td>$9F33</td>
        <td>L0_VSCROLL_H</td>
        <td colspan="4" align="center">-</td>
        <td colspan="8" align="center">V-Scroll (11:8)</td>
    </tr>
    <tr>
        <td>$9F34</td>
        <td>L1_CONFIG</td>
        <td colspan="2" align="center">Map Height</td>
        <td colspan="2" align="center">Map Width</td>
        <td colspan="1" align="center">T256C</td>
        <td colspan="1" align="center">Bitmap Mode</td>
        <td colspan="2" align="center">Color Depth</td>
    </tr>
    <tr>
        <td>$9F35</td>
        <td>L1_MAPBASE</td>
        <td colspan="8" align="center">Map Base Address (16:9)</td>
    </tr>
    <tr>
        <td>$9F36</td>
        <td>L1_TILEBASE</td>
        <td colspan="6" align="center">Tile Base Address (16:11)</td>
        <td colspan="1" align="center">Tile Height</td>
        <td colspan="1" align="center">Tile Width</td>
    </tr>
    <tr>
        <td>$9F37</td>
        <td>L1_HSCROLL_L</td>
        <td colspan="8" align="center">H-Scroll (7:0)</td>
    </tr>
    <tr>
        <td>$9F38</td>
        <td>L1_HSCROLL_H</td>
        <td colspan="4" align="center">-</td>
        <td colspan="8" align="center">H-Scroll (11:8)</td>
    </tr>
    <tr>
        <td>$9F39</td>
        <td>L1_VSCROLL_L</td>
        <td colspan="8" align="center">V-Scroll (7:0)</td>
    </tr>
    <tr>
        <td>$9F3A</td>
        <td>L1_VSCROLL_H</td>
        <td colspan="4" align="center">-</td>
        <td colspan="8" align="center">V-Scroll (11:8)</td>
    </tr>
    <tr>
        <td rowspan="2">$9F3B</td>
        <td rowspan="2">AUDIO_CTRL</td>
        <td colspan="1" align="center">FIFO Full / FIFO Reset</td>
        <td colspan="1" align="center">FIFO Empty<br />(read-only)</td>
        <td colspan="1" rowspan="2" align="center">16-Bit</td>
        <td colspan="1" rowspan="2" align="center">Stereo</td>
        <td colspan="4" rowspan="2" align="center">PCM Volume</td>
    </tr>
    <tr>
        <td colspan="2" align="center">FIFO Loop (write-only)</td>
    </tr>
    <tr>
        <td>$9F3C</td>
        <td>AUDIO_RATE</td>
        <td colspan="8" align="center">PCM Sample Rate</td>
    </tr>
    <tr>
        <td>$9F3D</td>
        <td>AUDIO_DATA</td>
        <td colspan="8" align="center">Audio FIFO data (write-only)</td>
    </tr>
    <tr>
        <td>$9F3E</td>
        <td>SPI_DATA</td>
        <td colspan="8" align="center">Data</td>
    </tr>
    <tr>
        <td>$9F3F</td>
        <td>SPI_CTRL</td>
        <td colspan="1" align="center">Busy</td>
        <td colspan="5" align="center">-</td>
        <td colspan="1" align="center">Slow clock</td>
        <td colspan="1" align="center">Select</td>
    </tr>
</table>

<h2 id="vram-address-space-layout">VRAM address space layout</h2>
<table>
<thead>
<tr>
<th>Address range</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>$0:0000 - $1:F9BF</td>
<td>Video RAM</td>
</tr>
<tr>
<td>$1:F9C0 - $1:F9FF</td>
<td>PSG registers</td>
</tr>
<tr>
<td>$1:FA00 - $1:FBFF</td>
<td>Palette</td>
</tr>
<tr>
<td>$1:FC00 - $1:FFFF</td>
<td>Sprite attributes</td>
</tr>
</tbody>
</table>
<p>The X16 KERNAL uses the following video memory layout:</p>
<table>
<thead>
<tr>
<th>Addresses</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>$0:0000-$1:2BFF</td>
<td>320x240@256c Bitmap</td>
</tr>
<tr>
<td>$1:2C00-$1:2FFF</td>
<td><em>unused</em> (1024 bytes)</td>
</tr>
<tr>
<td>$1:3000-$1:AFFF</td>
<td>Sprite Image Data (up to $1000 per sprite at 64x64 8-bit)</td>
</tr>
<tr>
<td>$1:B000-$1:EBFF</td>
<td>Text Mode</td>
</tr>
<tr>
<td>$1:EC00-$1:EFFF</td>
<td><em>unused</em> (1024 bytes)</td>
</tr>
<tr>
<td>$1:F000-$1:F7FF</td>
<td>Charset</td>
</tr>
<tr>
<td>$1:F800-$1:F9BF</td>
<td><em>unused</em> (448 bytes)</td>
</tr>
<tr>
<td>$1:F9C0-$1:F9FF</td>
<td>VERA PSG Registers (16 x 4 bytes)</td>
</tr>
<tr>
<td>$1:FA00-$1:FBFF</td>
<td>VERA Color Palette (256 x 2 bytes)</td>
</tr>
<tr>
<td>$1:FC00-$1:FFFF</td>
<td>VERA Sprite Attributes (128 x 8 bytes)</td>
</tr>
</tbody>
</table>
<p><strong>This memory map is not fixed</strong>: All of the address space between $0:0000 and $1:F9BF is available for any use in your programs, if you do not need text displayed by KERNAL or BASIC. This includes allocating multiple text or graphic buffers, or simply re-arranging the buffers to allow for
certain tile set layouts. Just be aware that once you move things around, you'll have to fully manage your bitmaps, tiles, and text/tile buffers.</p>
<p>To restore the standard text mode, call <code>CINT</code> ($FF81). This will reset the screen to the default screen mode. If you have configured custom settings in your NVRAM, these will be used.</p>
<p>Also, the registers in $1:F9C0-$1:FFFF are actually write-only. However, they share the same address as part of the video RAM. Be aware that when you read back the register data, you are actually reading the last value sent by the host system, which is not necessarily the value in the register.
To make sure this data is filled with known values, we recommend fully initializng the registers before use. Normally, the X16 KERNAL handles this for you, but if you are writing a cartridge program, using the system with a custom ROM, or even running VERA on another computer, then you'll
need to make sure this block gets initialized to known values.</p>
<h2 id="video-ram-access">Video RAM access</h2>
<p>The video RAM (VRAM) isn't directly accessible on the CPU bus. VERA only exposes an address space of 32 bytes to the CPU as described in the section <a href="#registers">Registers</a>. To access the VRAM (which is 128kB in size) an indirection mechanism is used. First the address to be accessed needs to be set (ADDRx_L/ADDRx_M/ADDRx_H) and then the data on that VRAM address can be read from or written to via the DATA0/1 register. To make accessing the VRAM more efficient an auto-increment mechanism is present.</p>
<p>There are 2 data ports to the VRAM. Which can be accessed using DATA0 and DATA1. The address and increment associated with the data port is specified in ADDRx_L/ADDRx_M/ADDRx_H. These 3 registers are multiplexed using the ADDR_SEL in the CTRL register. When ADDR_SEL = 0, ADDRx_L/ADDRx_M/ADDRx_H become ADDR0_L/ADDR0_M/ADDR0_H.
When ADDR_SEL = 1, ADDRx_L/ADDRx_M/ADDRx_H become ADDR1_L/ADDR1_M/ADDR1_H.</p>
<p>By setting the 'Address Increment' field in ADDRx_H, the address will be increment after each access to the data register. The increment register values and corresponding increment amounts are shown in the following table:</p>
<table>
<thead>
<tr>
<th style="text-align: right;">Register value</th>
<th style="text-align: right;">Increment amount</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
</tr>
<tr>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
</tr>
<tr>
<td style="text-align: right;">2</td>
<td style="text-align: right;">2</td>
</tr>
<tr>
<td style="text-align: right;">3</td>
<td style="text-align: right;">4</td>
</tr>
<tr>
<td style="text-align: right;">4</td>
<td style="text-align: right;">8</td>
</tr>
<tr>
<td style="text-align: right;">5</td>
<td style="text-align: right;">16</td>
</tr>
<tr>
<td style="text-align: right;">6</td>
<td style="text-align: right;">32</td>
</tr>
<tr>
<td style="text-align: right;">7</td>
<td style="text-align: right;">64</td>
</tr>
<tr>
<td style="text-align: right;">8</td>
<td style="text-align: right;">128</td>
</tr>
<tr>
<td style="text-align: right;">9</td>
<td style="text-align: right;">256</td>
</tr>
<tr>
<td style="text-align: right;">10</td>
<td style="text-align: right;">512</td>
</tr>
<tr>
<td style="text-align: right;">11</td>
<td style="text-align: right;">40</td>
</tr>
<tr>
<td style="text-align: right;">12</td>
<td style="text-align: right;">80</td>
</tr>
<tr>
<td style="text-align: right;">13</td>
<td style="text-align: right;">160</td>
</tr>
<tr>
<td style="text-align: right;">14</td>
<td style="text-align: right;">320</td>
</tr>
<tr>
<td style="text-align: right;">15</td>
<td style="text-align: right;">640</td>
</tr>
</tbody>
</table>
<p>Setting the <strong>DECR</strong> bit, will decrement instead of increment by the value set by the 'Address Increment' field.</p>
<h2 id="reset">Reset</h2>
<p>When <strong>RESET</strong> in <strong>CTRL</strong> is set to 1, the FPGA will reconfigure itself. All registers will be reset. The palette RAM will be set to its default values.</p>
<h2 id="interrupts">Interrupts</h2>
<p>Interrupts will be generated for the interrupt sources set in the lower 4 bits of <strong>IEN</strong>.
<strong>ISR</strong> will indicate the interrupts that have occurred. Writing a 1 to one of the lower 3 bits in <strong>ISR</strong> will clear that interrupt status. <strong>AFLOW</strong> can only be cleared by filling the audio FIFO for at least 1/4.</p>
<p><strong>IRQ_LINE</strong> (write-only) specifies at which line the <strong>LINE</strong> interrupt will be generated. Note that bit 8 of this value is present in the <strong>IEN</strong> register. For interlaced modes the interrupt will be generated each field and the bit 0 of <strong>IRQ_LINE</strong> is ignored.</p>
<p><strong>SCANLINE</strong> (read-only) indicates the current scanline being sent to the screen. Bit 8 of this value is present in the <strong>IEN</strong> register. The value is 0 during the first visible line and 479 during the last. This value continues to count beyond the last visible line, but returns $1FF for lines 512-524 that are beyond its 9-bit resolution. <strong>SCANLINE</strong> is not affected by interlaced modes and will return either all even or all odd values during an even or odd field, respectively. Note that VERA renders lines ahead of scanout such that line 1 is being rendered while line 0 is being scanned out. Visible changes may be delayed one scanline because of this.</p>
<p>The upper 4 (read-only) bits of the <strong>ISR</strong> register contain the <a href="#sprite-collisions">sprite collisions</a> as determined by the sprite renderer.</p>
<h2 id="display-composer">Display composer</h2>
<p>The display composer is responsible of combining the output of the 2 layer renderers and the sprite renderer into the image that is sent to the video output.</p>
<p>The video output mode can be selected using OUT_MODE in DC_VIDEO.</p>
<table>
<thead>
<tr>
<th style="text-align: right;">OUT_MODE</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: right;">0</td>
<td>Video disabled</td>
</tr>
<tr>
<td style="text-align: right;">1</td>
<td>VGA output</td>
</tr>
<tr>
<td style="text-align: right;">2</td>
<td>NTSC (composite/S-Video)</td>
</tr>
<tr>
<td style="text-align: right;">3</td>
<td>RGB 15KHz, composite or separate H/V sync, via VGA connector</td>
</tr>
</tbody>
</table>
<p>Setting <strong>'Chroma Disable'</strong> disables output of chroma in NTSC composite mode and will give a better picture on a monochrome display. <em>(Setting this bit will also disable the chroma output on the S-video output.)</em></p>
<p>Setting <strong>'HV Sync'</strong> enables separate HSync/VSync signals in RGB output mode. Clearing the bit will enable the default of composite sync over RGB.</p>
<p>Setting <strong>'240P'</strong> enables 240P progressive mode over NTSC or RGB. It has no effect if the VGA output mode is active. Instead of 262.5 scanlines per field, this mode outputs 263 scanlines per field.  On CRT displays, the scanlines from both the even and odd fields will be displayed on even scanlines.</p>
<p><strong>'Current Field'</strong> is a read-only bit which reflects the active interlaced field in composite and RGB modes. In non-interlaced modes, this reflects if the current line is even or odd. (0: even, 1: odd)</p>
<p>Setting <strong>'Layer0 Enable'</strong> / <strong>'Layer1 Enable'</strong> / <strong>'Sprites Enable'</strong> will respectively enable output from layer0 / layer1 and the sprites renderer.</p>
<p><strong>DC_HSCALE</strong> and <strong>DC_VSCALE</strong> will set the fractional scaling factor of the active part of the display. Setting this value to 128 will output 1 output pixel for every input pixel. Setting this to 64 will output 2 output pixels for every input pixel.</p>
<p><strong>DC_BORDER</strong> determines the palette index which is used for the non-active area of the screen.</p>
<p><strong>DC_HSTART</strong>/<strong>DC_HSTOP</strong> and <strong>DC_VSTART</strong>/<strong>DC_VSTOP</strong> determines the active part of the screen. The values here are specified in the native 640x480 display space. HSTART=0, HSTOP=640, VSTART=0, VSTOP=480 will set the active area to the full resolution. Note that the lower 2 bits of <strong>DC_HSTART</strong>/<strong>DC_HSTOP</strong> and the lower 1 bit of <strong>DC_VSTART</strong>/<strong>DC_VSTOP</strong> isn't available. This means that horizontally the start and stop values can be set at a multiple of 4 pixels, vertically at a multiple of 2 pixels.</p>
<p><strong>DC_VER0</strong>, <strong>DC_VER1</strong>, <strong>DC_VER2</strong>, and <strong>DC_VER3</strong> can be queried for the version number of the VERA bitstream.  If reading <strong>DC_VER0</strong> returns <code>$56</code>, the remaining registers returns values forming the major, minor, and build numbers respectively.  If <strong>DC_VER0</strong> returns a value other than <code>$56</code>, the VERA bitstream version number is undefined.</p>
<h2 id="layer-01-registers">Layer 0/1 registers</h2>
<p><strong>'Map Base Address'</strong> specifies the base address of the tile map. <em>Note that the register only specifies bits 16:9 of the address, so the address is always aligned to a multiple of 512 bytes.</em></p>
<p><strong>'Tile Base Address'</strong> specifies the base address of the tile data. <em>Note that the register only specifies bits 16:11 of the address, so the address is always aligned to a multiple of 2048 bytes.</em></p>
<p><strong>'H-Scroll'</strong> specifies the horizontal scroll offset. A value between 0 and 4095 can be used. Increasing the value will cause the picture to move left, decreasing will cause the picture to move right.</p>
<p><strong>'V-Scroll'</strong> specifies the vertical scroll offset. A value between 0 and 4095 can be used. Increasing the value will cause the picture to move up, decreasing will cause the picture to move down.</p>
<p><strong>'Map Width'</strong>, <strong>'Map Height'</strong> specify the dimensions of the tile map:</p>
<table>
<thead>
<tr>
<th style="text-align: right;">Value</th>
<th>Map width / height</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: right;">0</td>
<td>32 tiles</td>
</tr>
<tr>
<td style="text-align: right;">1</td>
<td>64 tiles</td>
</tr>
<tr>
<td style="text-align: right;">2</td>
<td>128 tiles</td>
</tr>
<tr>
<td style="text-align: right;">3</td>
<td>256 tiles</td>
</tr>
</tbody>
</table>
<p><strong>'Tile Width'</strong>, <strong>'Tile Height'</strong> specify the dimensions of a single tile:</p>
<table>
<thead>
<tr>
<th style="text-align: right;">Value</th>
<th>Tile width / height</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: right;">0</td>
<td>8 pixels</td>
</tr>
<tr>
<td style="text-align: right;">1</td>
<td>16 pixels</td>
</tr>
</tbody>
</table>
<p>In bitmap modes, the <strong>'H-Scroll (11:8)'</strong> register is used to specify the palette offset for the bitmap.</p>
<h3 id="layer-display-modes">Layer display modes</h3>
<p>The features of the 2 layers are the same. Each layer supports a few different modes which are specified using <strong>T256C</strong> / <strong>'Bitmap Mode'</strong> / <strong>'Color Depth'</strong> in Lx_CONFIG.</p>
<p><strong>'Color Depth'</strong> specifies the number of bits used per pixel to encode color information:</p>
<table>
<thead>
<tr>
<th style="text-align: right;">Color Depth</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: right;">0</td>
<td>1 bpp</td>
</tr>
<tr>
<td style="text-align: right;">1</td>
<td>2 bpp</td>
</tr>
<tr>
<td style="text-align: right;">2</td>
<td>4 bpp</td>
</tr>
<tr>
<td style="text-align: right;">3</td>
<td>8 bpp</td>
</tr>
</tbody>
</table>
<p>The layer can either operate in tile mode or bitmap mode. This is selected using the <strong>'Bitmap Mode'</strong> bit; 0 selects tile mode, 1 selects bitmap mode.</p>
<p>The handling of 1 bpp tile mode is different from the other tile modes. Depending on the <strong>T256C</strong> bit the tiles use either a 16-color foreground and background color or a 256-color foreground color. Other modes ignore the <strong>T256C</strong> bit.</p>
<h3 id="tile-mode-1-bpp-16-color-text-mode">Tile mode 1 bpp (16 color text mode)</h3>
<p><strong>T256C</strong> should be set to 0.</p>
<p><strong>MAP_BASE</strong> points to a tile map containing tile map entries, which are 2 bytes each:</p>
<table>
    <tr>
        <th>Offset</th>
        <th>Bit&nbsp;7</th>
        <th>Bit&nbsp;6</th>
        <th>Bit&nbsp;5</th>
        <th>Bit&nbsp;4</th>
        <th>Bit&nbsp;3</th>
        <th>Bit&nbsp;2</th>
        <th>Bit&nbsp;1</th>
        <th>Bit&nbsp;0</th>
    </tr>
    <tr>
        <td>0</td>
        <td align="center" colspan="8">Character index</td>
    </tr>
    <tr>
        <td>1</td>
        <td align="center" colspan="4">Background color</td>
        <td align="center" colspan="4">Foreground color</td>
    </tr>
</table>

<p><strong>TILE_BASE</strong> points to the tile data.</p>
<p>Each bit in the tile data specifies one pixel. If the bit is set the foreground color as specified in the map data is used, otherwise the background color as specified in the map data is used.</p>
<h3 id="tile-mode-1-bpp-256-color-text-mode">Tile mode 1 bpp (256 color text mode)</h3>
<p><strong>T256C</strong> should be set to 1.</p>
<p><strong>MAP_BASE</strong> points to a tile map containing tile map entries, which are 2 bytes each:</p>
<table>
    <tr>
        <th>Offset</th>
        <th>Bit&nbsp;7</th>
        <th>Bit&nbsp;6</th>
        <th>Bit&nbsp;5</th>
        <th>Bit&nbsp;4</th>
        <th>Bit&nbsp;3</th>
        <th>Bit&nbsp;2</th>
        <th>Bit&nbsp;1</th>
        <th>Bit&nbsp;0</th>
    </tr>
    <tr>
        <td>0</td>
        <td align="center" colspan="8">Character index</td>
    </tr>
    <tr>
        <td>1</td>
        <td align="center" colspan="8">Foreground color</td>
    </tr>
</table>

<p><strong>TILE_BASE</strong> points to the tile data.</p>
<p>Each bit in the tile data specifies one pixel. If the bit is set the foreground color as specified in the map data is used, otherwise color 0 is used (transparent).</p>
<h3 id="tile-mode-248-bpp">Tile mode 2/4/8 bpp</h3>
<p><strong>MAP_BASE</strong> points to a tile map containing tile map entries, which are 2 bytes each:</p>
<table>
    <tr>
        <th>Offset</th>
        <th>Bit&nbsp;7</th>
        <th>Bit&nbsp;6</th>
        <th>Bit&nbsp;5</th>
        <th>Bit&nbsp;4</th>
        <th>Bit&nbsp;3</th>
        <th>Bit&nbsp;2</th>
        <th>Bit&nbsp;1</th>
        <th>Bit&nbsp;0</th>
    </tr>
    <tr>
        <td>0</td>
        <td align="center" colspan="8">Tile index (7:0)</td>
    </tr>
    <tr>
        <td>1</td>
        <td align="center" colspan="4">Palette offset</td>
        <td align="center">V-flip</td>
        <td align="center">H-flip</td>
        <td align="center" colspan="2">Tile index (9:8)</td>
    </tr>
</table>

<p><strong>TILE_BASE</strong> points to the tile data.</p>
<p>Each pixel in the tile data gives a color index of either 0-3 (2bpp), 0-15 (4bpp), 0-255 (8bpp). This color index is modified by the palette offset in the tile map data using the following logic:</p>
<ul>
<li>Color index 0 (transparent) and 16-255 are unmodified.</li>
<li>Color index 1-15 is modified by adding 16 x palette offset.</li>
<li>T256C causes bit 7 of the color index to become 1.</li>
</ul>
<p>Note that 2bpp mode packs 4 pixels per byte and 4bpp mode packs 2 pixels per byte. For packed pixels, bit 7 refers to the leftmost pixel and bit 0 refers to the rightmost pixel.</p>
<h3 id="bitmap-mode-1248-bpp">Bitmap mode 1/2/4/8 bpp</h3>
<p><strong>MAP_BASE</strong> isn’t used in these modes. <strong>TILE_BASE</strong> points to the bitmap data.</p>
<p><strong>TILEW</strong> specifies the bitmap width. TILEW=0 results in 320 pixels width and TILEW=1 results in 640 pixels width.</p>
<p>The palette offset (in <strong>'H-Scroll (11:8)'</strong>), as well as T256C in non-1bpp mode modifies the color indexes of the bitmap in the same way as in the tile modes.</p>
<h2 id="spi-controller">SPI controller</h2>
<p>The SPI controller is connected to the SD card connector. The speed of the clock output of the SPI controller can be controlled by the <strong>'Slow Clock'</strong> bit. When this bit is 0 the clock is 12.5MHz, when 1 the clock is about 390kHz. The slow clock speed is to be used during the initialization phase of the SD card. Some SD cards require a clock less than 400kHz during part of the initialization.</p>
<p>A transfer can be started by writing to <strong>SPI_DATA</strong>. While the transfer is in progress the BUSY bit will be set. After the transfer is done, the result can be read from the <strong>SPI_DATA</strong> register.</p>
<p>The chip select can be controlled by writing the <strong>SELECT</strong> bit. Writing 1 will assert the chip-select (logic-0) and writing 0 will release the chip-select (logic-1).</p>
<h2 id="palette">Palette</h2>
<p>The palette translates 8-bit color indexes into 12-bit output colors. The palette has 256 entries, each with the following format:</p>
<table>
    <tr>
        <th>Offset</th>
        <th>Bit&nbsp;7</th>
        <th>Bit&nbsp;6</th>
        <th>Bit&nbsp;5</th>
        <th>Bit&nbsp;4</th>
        <th>Bit&nbsp;3</th>
        <th>Bit&nbsp;2</th>
        <th>Bit&nbsp;1</th>
        <th>Bit&nbsp;0</th>
    </tr>
    <tr>
        <td>0</td>
        <td align="center" colspan="4">Green</td>
        <td align="center" colspan="4">Blue</td>
    </tr>
    <tr>
        <td>1</td>
        <td align="center" colspan="4">-</td>
        <td align="center" colspan="4">Red</td>
    </tr>
</table>

<p>At reset, the palette will contain a predefined palette:</p>
<p><img alt="A picture of the Commander X16 palette" src="cx16palette.png" /></p>
<ul>
<li>Color indexes 0-15 contain a palette somewhat similar to the C64 color palette.</li>
<li>Color indexes 16-31 contain a grayscale ramp.</li>
<li>Color indexes 32-255 contain various hues, saturation levels, brightness levels.</li>
</ul>
<h2 id="sprite-attributes">Sprite attributes</h2>
<p>128 entries of the following format:</p>
<table>
    <tr>
        <th>Offset</th>
        <th>Bit&nbsp;7</th>
        <th>Bit&nbsp;6</th>
        <th>Bit&nbsp;5</th>
        <th>Bit&nbsp;4</th>
        <th>Bit&nbsp;3</th>
        <th>Bit&nbsp;2</th>
        <th>Bit&nbsp;1</th>
        <th>Bit&nbsp;0</th>
    </tr>
    <tr>
        <td>0</td>
        <td align="center" colspan="8">Address (12:5)</td>
    </tr>
    <tr>
        <td>1</td>
        <td>Mode</td>
        <td align="center" colspan="3">-</td>
        <td align="center" colspan="4">Address (16:13)</td>
    </tr>
    <tr>
        <td>2</td>
        <td align="center" colspan="8">X (7:0)</td>
    </tr>
    <tr>
        <td>3</td>
        <td align="center" colspan="6">-</td>
        <td align="center" colspan="2">X (9:8)</td>
    </tr>
    <tr>
        <td>4</td>
        <td align="center" colspan="8">Y (7:0)</td>
    </tr>
    <tr>
        <td>5</td>
        <td align="center" colspan="6">-</td>
        <td align="center" colspan="2">Y (9:8)</td>
    </tr>
    <tr>
        <td>6</td>
        <td align="center" colspan="4">Collision mask</td>
        <td align="center" colspan="2">Z-depth</td>
        <td align="center">V-flip</td>
        <td align="center">H-flip</td>
    </tr>
    <tr>
        <td>7</td>
        <td align="center" colspan="2">Sprite height</td>
        <td align="center" colspan="2">Sprite width</td>
        <td align="center" colspan="4">Palette offset</td>
    </tr>
</table>

<table>
<thead>
<tr>
<th>Mode</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>0</td>
<td>4 bpp</td>
</tr>
<tr>
<td>1</td>
<td>8 bpp</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th>Z-depth</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>0</td>
<td>Sprite disabled</td>
</tr>
<tr>
<td>1</td>
<td>Sprite between background and layer 0</td>
</tr>
<tr>
<td>2</td>
<td>Sprite between layer 0 and layer 1</td>
</tr>
<tr>
<td>3</td>
<td>Sprite in front of layer 1</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th>Sprite width / height</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>0</td>
<td>8 pixels</td>
</tr>
<tr>
<td>1</td>
<td>16 pixels</td>
</tr>
<tr>
<td>2</td>
<td>32 pixels</td>
</tr>
<tr>
<td>3</td>
<td>64 pixels</td>
</tr>
</tbody>
</table>
<p><strong>Rendering Priority</strong> The sprite memory location dictates the order in which it is rendered. The sprite whose attributes are at the lowest location will be rendered in front of all other sprites; the sprite at the highest location will be rendered behind all other sprites, and so forth.</p>
<p><strong>Palette offset</strong> works in the same way as with the layers.</p>
<h2 id="sprite-collisions">Sprite collisions</h2>
<p>At the start of the vertical blank <strong>Collisions</strong> in <strong>ISR</strong> is updated. This field indicates which groups of sprites have collided. If the field is non-zero the <strong>SPRCOL</strong> interrupt will be set. The interrupt is generated once per field / frame and can be cleared by making sure the sprites no longer collide.</p>
<p><em>Note that collisions are only detected on lines that are actually rendered. This can result in subtle differences between non-interlaced and interlaced video modes.</em></p>
<h2 id="vera-fx">VERA FX</h2>
<p>The FX feature set is available in VERA firmware version v0.3.1 or later. The Commander X16 emulators also have this feature officially as of R44.</p>
<p>FX is a set of mainly addressing mode changes. VERA FX does not accelerate rendering, but it merely assists the CPU with some of the slower tasks, and when used cleverly, can allow for the programmer to perform some limited perspective transforms or basic 3D effects.</p>
<p>FX features are controlled mainly by registers $9F29-$9F2C with DCSEL set to 2 through 6.  FX_CTRL ($9F29 w/ DCSEL=2) is the master switch for enabling or disabling FX behaviors.  When writing an application that uses FX, it is important that the FX mode be preserved and disabled in interrupt handlers in cases where the handler accesses VERA registers or VRAM, including the PSG sound registers. Reading from FX_CTRL returns the current state, and writing 0 to FX_CTRL suspends the FX behaviors so that the VERA can be accessed normally without mutating other FX state.</p>
<p>Preliminary documentation for the feature can be found in <a href="../X16%20Reference%20-%2010%20-%20VERA%20FX%20Reference/#chapter-10-vera-fx-reference">Chapter 10</a>, but as this is a brand new
 feature, examples and documentation still need to be written.</p>
<h2 id="programmable-sound-generator-psg">Programmable Sound Generator (PSG)</h2>
<p>The audio functionality contains of 2 independent systems. The first is the PSG or Programmable Sound Generator. The second is the PCM (or Pulse-Code Modulation) playback system.</p>
<p>16 entries (channels) of the following format:</p>
<table>
    <tr>
        <th>Offset</th>
        <th>Bit&nbsp;7</th>
        <th>Bit&nbsp;6</th>
        <th>Bit&nbsp;5</th>
        <th>Bit&nbsp;4</th>
        <th>Bit&nbsp;3</th>
        <th>Bit&nbsp;2</th>
        <th>Bit&nbsp;1</th>
        <th>Bit&nbsp;0</th>
    </tr>
    <tr>
        <td>0</td>
        <td align="center" colspan="8">Frequency word (7:0)</td>
    </tr>
    <tr>
        <td>1</td>
        <td align="center" colspan="8">Frequency word (15:8)</td>
    </tr>
    <tr>
        <td>2</td>
        <td align="center" colspan=1">Right</td>
        <td align="center" colspan=1">Left</td>
        <td align="center" colspan=6">Volume</td>
    </tr>
    <tr>
        <td>3</td>
        <td align="center" colspan="2">Waveform</td>
        <td align="center" colspan="6">Pulse width</td>
    </tr>
</table>

<p><strong>Frequency word</strong> sets the frequency of the sound.
The formula for calculating the output frequency is:</p>
<div class="language-text highlight"><pre><span></span><code>sample_rate = 25MHz / 512 = 48828.125 Hz

output_frequency = sample_rate / (2^17) * frequency_word
</code></pre></div>
<p>Thus the output frequency can be set in steps of about 0.373 Hz.</p>
<p><em>Example: to output a frequency of 440Hz (note A4) the </em><em>Frequency word</em><em> should be set to  440 / (48828.125 / (2^17)) = 1181</em></p>
<p><strong>Volume</strong> controls the volume of the sound with a logarithmic curve; 0 is silent, 63 is the loudest.
The <strong>Left</strong> and <strong>Right</strong> bits control to which output channels the sound should be output.</p>
<p><strong>Waveform</strong> controls the waveform of the sound:</p>
<table>
<thead>
<tr>
<th style="text-align: right;">Waveform</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: right;">0</td>
<td>Pulse</td>
</tr>
<tr>
<td style="text-align: right;">1</td>
<td>Sawtooth</td>
</tr>
<tr>
<td style="text-align: right;">2</td>
<td>Triangle</td>
</tr>
<tr>
<td style="text-align: right;">3</td>
<td>Noise</td>
</tr>
</tbody>
</table>
<p><strong>Pulse width</strong> controls the duty cycle of the pulse waveform. A value of 63 will give a 50% duty cycle or square wave, 0 will give a very narrow pulse.</p>
<p>Just like the other waveform types, the frequency of the noise waveform can be controlled using frequency. In this case a higher frequency will give brighter noise and a lower value will give darker noise.</p>
<h2 id="pcm-audio">PCM audio</h2>
<p>For PCM playback, VERA contains a 4kB FIFO buffer. This buffer needs to be filled in a timely fashion by the CPU. To facilitate this an <strong>AFLOW</strong> (Audio FIFO low) interrupt can be generated when the FIFO is less than 1/4 filled.</p>
<h3 id="audio-registers">Audio registers</h3>
<h4 id="audio_ctrl-9f3b"><code>AUDIO_CTRL ($9F3B)</code></h4>
<p><strong>FIFO Full</strong> (bit 7) is a read-only flag that indicates whether the FIFO is full. Any writes to the FIFO while this flag is 1 will be ignored. Writing a 1 to this register
(<strong>FIFO Reset</strong>) will perform a FIFO reset, which will clear the contents of the FIFO buffer, except when written in combination with a 1 in bit 6.</p>
<p><strong>FIFO Loop</strong> (bit 6+7): If a 1 is written to both bit 6 and 7 (at the same time), the FIFO will loop when played. Any other write to AUDIO_CTRL clears this loop flag.  Note: this feature is currently only available in x16-emulator and is not in any released VERA firmware.</p>
<p><strong>FIFO Empty</strong> (bit 6) is a read-only flag that indicates whether the FIFO is empty.</p>
<p><strong>16-bit</strong> (bit 5) sets the data format to 16-bit. If this bit is 0, 8-bit data is expected.</p>
<p><strong>Stereo</strong> (bit 4) sets the data format to stereo. If this bit is 0 (mono), the same audio data is send to both channels.</p>
<p><strong>PCM Volume</strong> (bits 0..3)controls the volume of the PCM playback, this has a logarithmic curve. A value of 0 is silence, 15 is the loudest.</p>
<h4 id="audio_rate-9f3c"><code>AUDIO_RATE ($9F3C)</code></h4>
<p><strong>PCM sample rate</strong> controls the speed at which samples are read from the FIFO. A few example values:</p>
<table>
<thead>
<tr>
<th style="text-align: right;">PCM sample rate</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: right;">128</td>
<td>normal speed   (25MHz / 512 = 48828.125 Hz)</td>
</tr>
<tr>
<td style="text-align: right;">64</td>
<td>half speed     (24414 Hz)</td>
</tr>
<tr>
<td style="text-align: right;">32</td>
<td>quarter speed  (12207 Hz)</td>
</tr>
<tr>
<td style="text-align: right;">0</td>
<td>stop playback</td>
</tr>
<tr>
<td style="text-align: right;"><em>&gt;128</em></td>
<td><em>invalid</em></td>
</tr>
</tbody>
</table>
<p>Using a value of 128 will give the best quality (lowest distortion); at this value for every output sample, an input sample from the FIFO is read. Lower values will output the same sample multiple times to the audio DAC. Input samples are always read as a complete set (being 1/2/4 bytes).</p>
<h4 id="audio_data-9f3d"><code>AUDIO_DATA ($9F3D)</code></h4>
<p><strong>Audio FIFO data</strong> Writes to this register add one byte to the PCM FIFO. If the FIFO is full, the write will be ignored.</p>
<p><em>NOTE: When setting up for PCM playback it is advised to first set the sample rate at 0 to stop playback. First fill the FIFO buffer with some initial data and then set the desired sample rate. This can prevent undesired FIFO underruns.</em></p>
<h3 id="audio-data-formats">Audio data formats</h3>
<p>Audio data is two's complement signed.
Depending on the selected mode the data needs to be written to the FIFO in the following order:</p>
<table>
<thead>
<tr>
<th>Mode</th>
<th>Order in which to write data to FIFO</th>
</tr>
</thead>
<tbody>
<tr>
<td>8-bit mono</td>
<td>&lt;mono sample&gt;</td>
</tr>
<tr>
<td>8-bit stereo</td>
<td>&lt;left sample&gt; &lt;right sample&gt;</td>
</tr>
<tr>
<td>16-bit mono</td>
<td>&lt;mono sample (7:0)&gt; &lt;mono sample (15:8)&gt;</td>
</tr>
<tr>
<td>16-bit stereo</td>
<td>&lt;left sample (7:0)&gt; &lt;left sample (15:8)&gt; &lt;right sample (7:0)&gt; &lt;right sample (15:8)&gt;</td>
</tr>
</tbody>
</table>
<!-- For PDF formatting -->
<div class="page-break"></div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="Footer" >
        
          
          <a href="../X16%20Reference%20-%2008%20-%20Memory%20Map/" class="md-footer__link md-footer__link--prev" aria-label="Previous: 8: Memory Map">
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Previous
              </span>
              <div class="md-ellipsis">
                8: Memory Map
              </div>
            </div>
          </a>
        
        
          
          <a href="../X16%20Reference%20-%2010%20-%20VERA%20FX%20Reference/" class="md-footer__link md-footer__link--next" aria-label="Next: 10: VERA FX Reference">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Next
              </span>
              <div class="md-ellipsis">
                10: VERA FX Reference
              </div>
            </div>
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
      <div class="md-progress" data-md-component="progress" role="progressbar"></div>
    
    
    <script id="__config" type="application/json">{"base": "..", "features": ["navigation.footer", "navigation.indexes", "navigation.instant", "navigation.instant.progress", "navigation.prune", "navigation.tracking", "toc.follow", "search.suggest", "search.share", "header.autohide"], "search": "../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.081f42fc.min.js"></script>
      
    
  </body>
</html>